# 1on1テストセッション申込確認メールテンプレート

## 概要

`session_form_submitted` イベント発火時（1on1テストセッション申込フォーム送信時）に送信するメールテンプレートです。現在は手動送信を想定していますが、将来的に自動化する際の基準としても使用します。

---

## メールテンプレート（日本語版）

### 件名

```
[Exit Readiness OS] 1on1テストセッションのお申込みありがとうございます
```

### 本文

```
{お名前} 様

この度は Exit Readiness OS の1on1テストセッションにお申込みいただき、誠にありがとうございます。

以下の内容で申込を受け付けました。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ お申込み内容
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

お名前：{お名前}
メールアドレス：{メールアドレス}
現在の住宅状況：{現在の住宅状況}
世帯年収レンジ：{世帯年収レンジ}
物件価格帯：{物件価格帯}
ゴールモード：{ゴールモード}
希望日時：{希望日時}

その他ご要望：
{その他ご要望}

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ 次のステップ
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 日程調整

   以下のいずれかの方法で日程を調整させていただきます：

   【方法A】候補日をご連絡ください
   このメールに返信する形で、ご都合の良い日時を3つほどお知らせください。
   （例：1月15日（月）19:00〜、1月17日（水）20:00〜、1月20日（土）10:00〜）

   【方法B】Calendlyで予約
   以下のリンクから直接ご予約いただけます：
   https://calendly.com/exit-os/1on1-session （※実際のリンクに置き換え）

2. セッション準備

   セッションをより有意義なものにするため、以下の情報をあらかじめご用意ください：

   ✓ 世帯年収（手取りまたは額面）
   ✓ 現在の金融資産（概算でOK）
   ✓ 住宅ローン残高（持ち家の場合）
   ✓ 月々の生活費（ざっくりでOK）
   ✓ 比較したい世界線（例：賃貸継続 vs 6,000万購入 vs 8,000万購入）

   ※ 正確な数字でなくても構いません。概算で結構です。

3. セッション当日

   - 所要時間：90分
   - 実施方法：Zoom（リンクは日程確定後にお送りします）
   - 準備物：上記の情報（メモやスプレッドシートなど）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ セッションで一緒にやること
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 前提の整理
   - あなたの状況（年収・資産・住宅・キャリア・ライフイベント）を確認

2. 世界線の設定
   - 比較したい選択肢（賃貸継続・購入・海外駐在など）を2〜3本に絞る

3. 指標の計算
   - 40〜50代のキャッシュフロー余裕
   - 60歳時点の資産残高
   - 取り崩し開始年齢
   これらを各世界線で計算し、比較します。

4. インサイトの共有
   - 数字だけでなく、「この世界線を選ぶとどうなるか」を一緒に考えます。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ セッション後のアウトプット
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

セッション終了後、以下の「世界線メモ」をお送りします：

- 前提の整理（匿名化済み）
- 比較した世界線（2〜3本）
- 指標差分（40〜50代CF余裕、60歳資産、取り崩し開始年齢）
- インサイト（判断のポイント）

このメモは、あなたの意思決定の参考資料としてご活用ください。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━
■ ご不明点・キャンセルについて
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

ご不明点やキャンセルのご希望がございましたら、このメールに返信する形でお知らせください。

キャンセルポリシー：
- セッション開始24時間前まで：無料でキャンセル可能
- セッション開始24時間以内：キャンセル料50%
- 無断キャンセル：キャンセル料100%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━

それでは、セッションでお会いできることを楽しみにしております。

Exit Readiness OS チーム
https://exit-os.xxx/ （※実際のURLに置き換え）
```

---

## メール送信タイミング

### 自動送信（将来的に実装）

- **トリガー:** `session_form_submitted` イベント発火時
- **送信先:** フォームで入力されたメールアドレス
- **送信方法:** SMTP / SendGrid / AWS SES など

### 手動送信（現在）

1. `testSessions` テーブルに新しい申込が追加される
2. PdMがデータベースまたは管理画面で申込内容を確認
3. 上記のテンプレートをコピーし、{変数}部分を実際の値に置き換え
4. Gmail / Outlook などから手動送信

---

## 変数一覧

メールテンプレート内の `{変数}` は、以下のデータベースカラムから取得します：

| 変数 | データベースカラム | 例 |
|---|---|---|
| `{お名前}` | `testSessions.name` | 山田太郎 |
| `{メールアドレス}` | `testSessions.email` | yamada@example.com |
| `{現在の住宅状況}` | `testSessions.currentHousing` | 賃貸 |
| `{世帯年収レンジ}` | `testSessions.incomeRange` | 1500-2000 |
| `{物件価格帯}` | `testSessions.propertyRange` | 6000 |
| `{ゴールモード}` | `testSessions.goalMode` | ゆるExit |
| `{希望日時}` | `testSessions.preferredTime` | 平日夜または週末 |
| `{その他ご要望}` | `testSessions.notes` | 海外駐在の可能性を考慮したい |

---

## 自動化実装案（将来）

### 方法1: tRPC Mutation内で送信

```typescript
// server/routers.ts
testSession: router({
  submit: publicProcedure
    .input(testSessionSchema)
    .mutation(async ({ input }) => {
      // Insert to database
      const result = await insertTestSession(input);

      // Send confirmation email
      await sendEmail({
        to: input.email,
        subject: "[Exit Readiness OS] 1on1テストセッションのお申込みありがとうございます",
        html: generateConfirmationEmail(input),
      });

      return { success: true, id: result[0].insertId };
    }),
}),
```

### 方法2: Webhook経由

1. `session_form_submitted` イベント発火時にWebhookを送信
2. 外部サービス（Zapier / Make / n8n）でメール送信

### 方法3: キュー経由（推奨）

1. `testSessions` テーブルに申込を保存
2. バックグラウンドジョブ（BullMQ / Inngest）でメール送信
3. 送信失敗時のリトライ処理

---

## テスト方法

### 手動テスト

1. 開発環境で1on1申込フォームを送信
2. `testSessions` テーブルにデータが保存されることを確認
3. 上記のテンプレートを使って手動でメール送信
4. メールが正しく届くか確認

### 自動化後のテスト

1. 開発環境で1on1申込フォームを送信
2. メールが自動送信されることを確認
3. メール内容が正しいか確認（変数が正しく置換されているか）
4. 送信失敗時のエラーハンドリングを確認

---

## 注意事項

1. **個人情報保護**
   - メールアドレスは暗号化せず平文で保存（HTTPS通信で保護）
   - メール送信ログは別途保存（送信日時・送信先・送信結果）

2. **スパム対策**
   - 送信元メールアドレスは `noreply@exit-os.xxx` などの専用アドレスを使用
   - SPF / DKIM / DMARC を設定

3. **配信停止**
   - メール末尾に「配信停止リンク」を追加（将来的に）

---

## 関連ドキュメント

- [世界線メモフォーマット](./session-worldline-memo-template.md)（次に作成）
- [Evidence Pack運用ルール](./evidence-pack-operation-rules.md)
- [Fit Gateログ設計](./fitgate-log-design.md)
